<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <title>Shop Homepage - Start Bootstrap Template</title>
  <!-- Favicon-->
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  <!-- Bootstrap icons-->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="css/styles.css" rel="stylesheet" />
</head>
<body>
<!-- Navigation-->
<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
  <div class="container px-4 px-lg-5">
    <a class="navbar-brand" href="#">Start Bootstrap</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-lg-4">
        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="#">About</a></li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Shop</a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
            <li><a class="dropdown-item" href="#">All Products</a></li>
            <li><hr class="dropdown-divider" /></li>
            <li><a class="dropdown-item" href="#">Popular Items</a></li>
            <li><a class="dropdown-item" href="#">New Arrivals</a></li>
          </ul>
        </li>
        <li class="nav-item dropdown" id="manageDropdown" style="display: none;">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Manage</a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown" id="manageDropdown-menu">
          </ul>
        </li>
      </ul>
      <div id="user-info" class="nav-item">未登入</div>
      <a href="login.html" id="login-button">
        <button class="btn btn-light">
          <i class="bi-person-circle" ></i>
        </button>
      </a>
      <div class="dropdown">
        <button class="btn btn-light dropdown-toggle" type="button" id="cartDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="bi-cart-fill me-2"></i>
          Cart
          <span class="badge bg-dark text-white ms-1 rounded-pill" id="cart-count">0</span>
        </button>
        <!-- 下拉購物車 -->
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="cartDropdown" style="min-width: 300px;">
          <li><h6 class="dropdown-header">購物車內容</h6></li>
          <li id="cart-table">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>商品名稱</th>
                  <th>價格</th>
                  <th>數量</th>
                  <th>小計</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody id="cart-items">
              </tbody>
            </table>
          </li>
          <li><hr class="dropdown-divider"></li>
          <li>
            <h6 class="dropdown-header">總價: $<span id="total-price">0</span></h6>
          </li>
          <li>
            <a class="dropdown-item text-center" href="checkout.html">前往結帳</a>
          </li>
        </ul>
      </div>
      <div id="logout-button">
      </div>
    </div>
  </div>
</nav>
<!-- Header-->
<header class="bg-dark py-5">
  <div class="container px-4 px-lg-5 my-5">
    <div class="text-center text-white">
      <h1 class="display-4 fw-bolder">Shop in style</h1>
      <p class="lead fw-normal text-white-50 mb-0">With this shop hompeage template</p>
    </div>
  </div>
</header>
<!-- Section-->
<section class="py-5">
  <div class="row mb-3">
    <div class="col-md-4">
      <label for="categoryFilter" class="form-label">商品類別</label>
      <select id="categoryFilter" class="form-select">
        <option value="">全部類別</option>
        <option value="Category A">Category A</option>
        <option value="Category B">Category B</option>
        <option value="Category C">Category C</option>
      </select>
    </div>
    <div class="col-md-4">
      <label for="nameSearch" class="form-label">商品名稱搜尋</label>
      <input type="text" id="nameSearch" class="form-control" placeholder="輸入商品名稱">
    </div>
    <div class="col-md-4">
      <label for="itemsPerPage" class="form-label">每頁顯示</label>
      <select id="itemsPerPage" class="form-select">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
      </select>
    </div>
  </div>

  <div class="container px-4 px-lg-5 mt-5">
    <!-- 商品列表 -->
    <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center" id="productList">

    </div>
    <!-- 分頁控制 -->
    <nav aria-label="Page navigation" class="mt-4">
      <ul class="pagination justify-content-center" id="pagination"></ul>
    </nav>

    <!-- 查詢出的總筆數 -->
    <div class="mt-3">
      <p>總筆數: <span id="totalItems">0</span></p>
    </div>
  </div>
</section>
<!-- Footer-->
<footer class="py-5 bg-dark">
  <div class="container"><p class="m-0 text-center text-white">Copyright &copy; Your Website 2023</p></div>
</footer>
<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script>
  let currentPage = 1;
  let itemsPerPage = 5;
  let productList;


  function fetchProducts() {
    const category = document.getElementById('categoryFilter').value;
    const search = document.getElementById('nameSearch').value;
    itemsPerPage = document.getElementById('itemsPerPage').value;
    let url = new URL('/products', window.location.origin);
    url.searchParams.append('category', category);
    url.searchParams.append('search', search);
    url.searchParams.append('pageNumber', currentPage);
    url.searchParams.append('pageSize', itemsPerPage);

    fetch(url)
    .then(response => response.json())
    .then(data => {
      renderProductList(data.result);
      renderPagination(data.totalItems, data.totalPages);
      document.getElementById('totalItems').textContent = data.totalItems;
    })
    .catch(error => console.error('Error fetching products:', error));
  }

  document.addEventListener('DOMContentLoaded', function() {
    debugger
    initUserInfo();
    fetchProducts();
    updateCartDisplay();
  });

  function renderProductList(products) {
    productList = products;
    const productListHTML = document.getElementById('productList');
    products.forEach(product => {
      const productHTML = `
        <div class="col mb-5">
          <div class="card h-100">
            <img class="card-img-top" src="${product.imageUrl}" alt="..." />
            <div class="card-body p-4">
              <div class="text-center">
                <h5 class="fw-bolder">${product.productName}</h5>
                <p class="card-text">Price: $${product.price}</p>
                <button class="btn btn-primary" onclick="addToCart(${product.id})">加入購物車</button>
              </div>
            </div>
          </div>
        </div>`;
      productListHTML.innerHTML += productHTML;
    });
  }
</script>
</body>
</html>
